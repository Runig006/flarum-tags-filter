{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@runig006/tag-filter/webpack/bootstrap","webpack://@runig006/tag-filter/webpack/runtime/compat get default export","webpack://@runig006/tag-filter/webpack/runtime/define property getters","webpack://@runig006/tag-filter/webpack/runtime/hasOwnProperty shorthand","webpack://@runig006/tag-filter/webpack/runtime/make namespace object","webpack://@runig006/tag-filter/external root \"flarum.core.compat['common/extend']\"","webpack://@runig006/tag-filter/external root \"flarum.core.compat['forum/app']\"","webpack://@runig006/tag-filter/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@runig006/tag-filter/./node_modules/@babel/runtime/helpers/esm/extends.js","webpack://@runig006/tag-filter/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@runig006/tag-filter/external root \"flarum.core.compat['forum/components/Page']\"","webpack://@runig006/tag-filter/external root \"flarum.core.compat['common/Component']\"","webpack://@runig006/tag-filter/external root \"flarum.core.compat['common/components/Button']\"","webpack://@runig006/tag-filter/external root \"flarum.core.compat['common/components/Dropdown']\"","webpack://@runig006/tag-filter/external root \"flarum.core.compat['common/utils/ItemList']\"","webpack://@runig006/tag-filter/./src/forum/components/TagsDropdown.js","webpack://@runig006/tag-filter/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@runig006/tag-filter/external root \"flarum.core.compat['forum/states/GlobalSearchState']\"","webpack://@runig006/tag-filter/./src/forum/index.js"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","export default function _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/Page'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Component'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Dropdown'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/ItemList'];","import Component from 'flarum/common/Component';\nimport Button from 'flarum/common/components/Button';\nimport Dropdown from 'flarum/common/components/Dropdown';\nimport app from 'flarum/forum/app';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport { getSelected, refreshTags } from '../index.js';\n\nexport default class TagsDropdown extends Dropdown {\n    static initAttrs(attrs) {\n        super.initAttrs(attrs);\n        attrs.label = \"Tags\";\n        attrs.className = 'TagFilter';\n        attrs.buttonClassName = 'TagFilter-item Button';\n        attrs.menuClassName = 'Dropdown-menu--right';\n    }\n\n    view(vnode) {\n        return super.view({ ...vnode, children: this.items().toArray() });\n    }\n\n    items() {\n        let selected = getSelected();\n        const tags = app.store.all('tags');\n        const items = new ItemList();\n        const t = this;\n        tags.forEach(tag => {\n            let cl = 'Button';\n            if (selected.indexOf(tag.slug()) >= 0) {\n                cl += ' active';\n            }\n            items.add(\n                tag.slug(),\n                Button.component(\n                    {\n                        class: cl,\n                        onclick() {\n                            t.handleTagChange(tag)\n                        },\n                    },\n                    tag.name()\n                ),\n            );\n        });\n        return items;\n    }\n\n    handleTagChange(tag) {\n        let selected = getSelected();\n        let index = selected.indexOf(tag.slug());\n        if (index >= 0) {\n            selected.splice(index, 1);\n        } else {\n            selected.push(tag.slug());\n        }\n        localStorage.setItem('spy-tags-filters', JSON.stringify(selected));\n        refreshTags();\n    }\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/states/GlobalSearchState'];","import { extend } from 'flarum/common/extend';\nimport app from 'flarum/forum/app';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport Page from 'flarum/forum/components/Page';\nimport TagsDropdown from './components/TagsDropdown';\nimport GlobalSearchState from 'flarum/forum/states/GlobalSearchState';\n\nexport function getSelected() {\n  let saved = localStorage.getItem('spy-tags-filters');\n  let selected = [];\n  if (saved) {\n    selected = JSON.parse(saved);\n  } else {\n    selected = [];\n  }\n  return selected;\n}\n\nexport function refreshTags() {\n  let params = app.search.params();\n  let selected = getSelected();\n  if (selected.length > 0) {\n    params.tag = selected.join(',');\n  } else {\n    params.tag = null;\n    delete params.tag;\n  }\n  app.discussions.refreshParams(params, 2);\n}\n\napp.initializers.add('runig006/user-filter', () => {\n  extend(IndexPage.prototype, 'viewItems', function (items) {\n    let array = ['index', 'following'];\n    if (array.indexOf(app.current.data.routeName) == -1) {\n      return\n    };\n    items.add('filter-tags', <TagsDropdown />);\n  });\n\n  extend(IndexPage.prototype, 'oninit', function (items) {\n    if (app.previous.type == null) {\n      refreshTags();\n    }\n  });\n\n  extend(GlobalSearchState.prototype, 'params', function (params) {\n    let selected = getSelected();\n    if (params.filter == null) {\n      params.filter = {};\n    }\n    if (selected.length > 0) {\n      params.filter.tag = selected.join(',');\n    }\n  });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_extends","assign","target","i","arguments","length","source","apply","this","_setPrototypeOf","p","setPrototypeOf","__proto__","TagsDropdown","subClass","superClass","create","constructor","initAttrs","attrs","label","className","buttonClassName","menuClassName","view","vnode","children","items","toArray","selected","getSelected","tags","app","ItemList","t","forEach","tag","cl","indexOf","slug","add","Button","class","onclick","handleTagChange","name","index","splice","push","localStorage","setItem","JSON","stringify","refreshTags","Dropdown","saved","getItem","parse","params","join","extend","IndexPage","GlobalSearchState","filter"],"sourceRoot":""}